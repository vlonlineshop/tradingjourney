<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Trading Journey Harian & Rekap</title>
<style>
  body {
    background: #0a0f14;
    color: #0ff;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    margin: 0; padding: 20px;
  }
  .container {
    max-width: 900px;
    margin: auto;
    background: #121a26;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 0 15px #0ff6;
  }
  input[type=text], input[type=number], select {
    width: 200px;
    padding: 10px;
    border: 2px solid #0ff;
    border-radius: 5px;
    background: #01111f;
    color: #0ff;
    font-size: 16px;
    margin-right: 10px;
    margin-bottom: 10px;
  }
  button {
    padding: 10px 20px;
    background: #0ff;
    border: none;
    border-radius: 5px;
    color: #012;
    font-weight: bold;
    cursor: pointer;
    transition: background 0.3s ease;
  }
  button:hover {
    background: #06c;
    color: #aaffff;
  }
  #dashboard {
    margin-top: 30px;
    display: none;
    animation: fadeIn 1s ease forwards;
  }
  @keyframes fadeIn { from {opacity: 0;} to {opacity: 1;} }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 15px;
  }
  th, td {
    border: 1px solid #0ff;
    padding: 8px;
    text-align: center;
  }
  th {
    background-color: #022;
    color: #0ff;
  }
  .stats {
    display: flex;
    justify-content: space-around;
    margin-bottom: 15px;
    flex-wrap: wrap;
  }
  .stat-box {
    background: #01111f;
    padding: 10px 20px;
    border-radius: 8px;
    box-shadow: 0 0 10px #0ff7;
    min-width: 120px;
    margin: 5px;
  }
  #analysis {
    margin-top: 15px;
    background: #022;
    padding: 10px;
    border-radius: 8px;
    box-shadow: 0 0 10px #0ff8;
    min-height: 50px;
    font-weight: bold;
  }
  nav {
    margin-bottom: 20px;
    display: flex;
    justify-content: center;
    gap: 20px;
  }
  nav a {
    color: #0ff;
    text-decoration: none;
    font-weight: bold;
    transition: color 0.3s;
  }
  nav a:hover {
    color: #fff;
  }
   /* Risk Management Content (Hidden by default) */
    #mainContent {
      display: none;
      padding: 20px;
      animation: fadeIn 1s ease forwards;
    }
  /* Neon Login Container */
    #authContainer {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      background: radial-gradient(circle at center, #001e2f 0%, #000 100%);
      animation: pulseGlow 5s infinite alternate;
      box-shadow: inset 0 0 50px #00f2ff33;
      border-radius: 12px;
      padding: 40px;
      text-align: center;
    }

    #authContainer h1 {
      font-size: 2.5rem;
      text-shadow: 0 0 10px #0ff, 0 0 20px #0ff2;
    }

    #authContainer p {
      font-size: 1.2rem;
      color: #88f;
      text-shadow: 0 0 5px #0ff2;
    }

    #accessCode {
      padding: 12px;
      font-size: 1.1rem;
      width: 240px;
      border: none;
      border-radius: 8px;
      background: #020b14;
      color: #0ff;
      outline: none;
      box-shadow: 0 0 10px #00f2ff88;
    }

    #accessCode:focus {
      box-shadow: 0 0 20px #00f2ffcc;
    }

    #authContainer button {
      margin-top: 20px;
      padding: 10px 24px;
      background: #00aaff;
      border: none;
      border-radius: 6px;
      color: #fff;
      font-size: 1.1rem;
      cursor: pointer;
      box-shadow: 0 0 10px #00f2ffaa;
      transition: background 0.3s ease, transform 0.3s ease;
    }

    #authContainer button:hover {
      background: #008ecc;
      transform: scale(1.05);
      box-shadow: 0 0 20px #00f2ffff;
    }
   @keyframes pulseGlow {
      0% { box-shadow: inset 0 0 30px #00f2ff33; }
      100% { box-shadow: inset 0 0 60px #00f2ff99; }
    }

</style>
</head>
<body>
<body oncontextmenu="return false">

  <!-- AUTH GATE -->
  <div id="authContainer">
    <h1>üîê Akses Terbatas</h1>
    <p>Masukkan Kode Akses</p>
    <input type="password" id="accessCode" placeholder="Kode Akses..." />
    <button onclick="validateAccess()">Masuk</button>
  </div>

  <!-- MAIN CONTENT -->
  <div id="mainContent">
    <nav>
      <a href="index.html">Dashboard</a>
      <a href="risk-management.html">Risk Management</a>
      <a href="maintenance.html">Money Management</a>
    </nav>

  <div id="dashboard">
    <h2>Welcome, <span id="usernameDisplay"></span>!</h2>
    <div class="stats">
      <div class="stat-box">Saldo Awal Hari Ini: $<span id="initialBalanceDisplay"></span></div>
      <div class="stat-box">Saldo Akhir: $<span id="finalBalanceDisplay"></span></div>
      <div class="stat-box">Total Pips: <span id="totalPipsDisplay"></span></div>
      <div class="stat-box">Total Trade: <span id="totalTradesDisplay"></span></div>
      <div class="stat-box">Winrate: <span id="winrateDisplay"></span></div>
    </div>

    <div id="analysis">Analisa Trading Harian: <span id="analysisText">-</span></div>

    <!-- Tambah Posisi -->
    <form id="openTradeForm">
      <h3>Tambah Posisi Terbuka</h3>
      <select id="pair" required>
        <option value="" disabled selected>Pilih Pair</option>
        <option value="XAUUSD">XAUUSD</option>
        <option value="BTCUSD">BTCUSD</option>
      </select>
      <input type="number" id="lot" step="0.01" min="0.01" required placeholder="Lot" />
      <select id="position" required>
        <option value="BUY">BUY</option>
        <option value="SELL">SELL</option>
      </select>
      <input type="number" id="entryPrice" step="0.01" min="0" required placeholder="Harga Entry (2 angka koma)" />
      <input type="text" id="reason" required placeholder="Alasan Entry" />
      <button type="submit">Tambah</button>
    </form>

    <!-- Posisi Terbuka -->
    <h3>Posisi Terbuka</h3>
    <table id="openTradesTable">
      <thead>
        <tr><th>Pair</th><th>Lot</th><th>Posisi</th><th>Harga Entry</th><th>Alasan</th><th>Waktu Entry</th><th>Aksi</th></tr>
      </thead>
      <tbody id="openTradesBody"></tbody>
    </table>

    <!-- Riwayat Trading -->
<h3>Riwayat Trading <button id="downloadHistory">Download CSV</button></h3>
<table id="tradeHistory">
  <thead>
    <tr><th>Pair</th><th>Lot</th><th>Posisi</th><th>Harga Entry</th><th>Harga Tutup</th><th>Pips</th><th>Profit (USDc)</th><th>Waktu Entry</th><th>Waktu Tutup</th><th>Alasan</th></tr>
      </thead>
      <tbody></tbody>
    </table>

    <!-- Rekap Harian -->
    <h3>Rekap Trading Harian <button id="downloadRekap">Download CSV</button></h3>
    <table id="dailySummaryTable">
      <thead>
        <tr><th>Tanggal</th><th>Saldo Awal</th><th>Saldo Akhir</th><th>Pertumbuhan (%)</th><th>Total Trade</th><th>Analisa</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
</div>
<script>
  // ========== BLOKIR DEV TOOLS & KLIK KANAN ==========
document.addEventListener("contextmenu", e => e.preventDefault());
document.addEventListener("keydown", e => {
  if ((e.ctrlKey && ["i", "j", "u", "s"].includes(e.key.toLowerCase())) || e.key === "F12") {
    e.preventDefault();
  }
});

// ========== SISTEM AKSES ==========
function validateAccess() {
  const input = document.getElementById('accessCode');
  if (!input) return alert("Input kode akses tidak ditemukan.");
  const code = input.value.trim().toUpperCase();
  if (code === 'VL') {
    document.getElementById('authContainer').style.display = 'none';
    document.getElementById('mainContent').style.display = 'block';
    if (typeof calculateLayers === "function") calculateLayers();
    loadFromLocalStorage();
  } else {
    alert('Kode akses salah!');
  }
}

// ========== TAMBAH POSISI TERBUKA ==========
const openTrades = JSON.parse(localStorage.getItem("openTrades") || "[]");
document.getElementById("openTradeForm")?.addEventListener("submit", function (e) {
  e.preventDefault();
  const pair = document.getElementById("pair").value;
  const lot = parseFloat(document.getElementById("lot").value);
  const position = document.getElementById("position").value;
  const entryPrice = parseFloat(document.getElementById("entryPrice").value);
  const reason = document.getElementById("reason").value;
  const entryTime = new Date().toLocaleString();

  if (!pair || isNaN(lot) || !position || isNaN(entryPrice)) {
    return alert("Mohon isi semua field dengan benar.");
  }

  const trade = { pair, lot, position, entryPrice, reason, entryTime };
  openTrades.push(trade);
  localStorage.setItem("openTrades", JSON.stringify(openTrades));
  renderOpenTrades();
  this.reset();
});

function renderOpenTrades() {
  const tbody = document.getElementById("openTradesBody");
  if (!tbody) return;
  tbody.innerHTML = "";
  openTrades.forEach((t, i) => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${t.pair}</td><td>${t.lot}</td><td>${t.position}</td>
      <td>${t.entryPrice}</td><td>${t.reason}</td><td>${t.entryTime}</td>
      <td><button onclick="closeTrade(${i})">Tutup</button></td>`;
    tbody.appendChild(tr);
  });
}

// ========== TUTUP POSISI ==========
const history = JSON.parse(localStorage.getItem("tradeHistory") || "[]");
function closeTrade(index) {
  const input = prompt("Harga tutup?");
  if (!input) return;
  const exitPrice = parseFloat(input.replace(",", "."));
  if (isNaN(exitPrice)) return alert("Harga tidak valid.");

  const trade = openTrades.splice(index, 1)[0];
  const pips = (trade.position === "BUY" ? exitPrice - trade.entryPrice : trade.entryPrice - exitPrice) * 10;
  const profit = (pips * trade.lot * 0.1).toFixed(2); // 0.1 USD per pip per 0.01 lot
  const closeTime = new Date().toLocaleString();
  const result = { ...trade, exitPrice, pips: pips.toFixed(1), profit, closeTime };
  history.push(result);

  localStorage.setItem("openTrades", JSON.stringify(openTrades));
  localStorage.setItem("tradeHistory", JSON.stringify(history));
  renderOpenTrades();
  renderTradeHistory();
  updateDailySummary();
}

// ========== RENDER HISTORY ==========
function renderTradeHistory() {
  const tbody = document.querySelector("#tradeHistory tbody");
  if (!tbody) return;
  tbody.innerHTML = "";
  history.forEach(t => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${t.pair}</td><td>${t.lot}</td><td>${t.position}</td>
      <td>${t.entryPrice}</td><td>${t.exitPrice}</td><td>${t.pips}</td>
      <td>${t.profit}</td><td>${t.entryTime}</td><td>${t.closeTime}</td><td>${t.reason}</td>`;
    tbody.appendChild(tr);
  });
}

// ========== RENDER RINGKASAN HARIAN ==========
function updateDailySummary() {
  const dataByDate = {};
  history.forEach(t => {
    const date = new Date(t.closeTime).toLocaleDateString();
    if (!dataByDate[date]) dataByDate[date] = { totalTrades: 0, profits: 0 };
    dataByDate[date].totalTrades++;
    dataByDate[date].profits += parseFloat(t.profit);
  });

  const tbody = document.querySelector("#dailySummaryTable tbody");
  if (!tbody) return;
  tbody.innerHTML = "";
  Object.entries(dataByDate).forEach(([date, data]) => {
    const saldoAwal = 1000;
    const saldoAkhir = saldoAwal + data.profits;
    const growth = ((saldoAkhir - saldoAwal) / saldoAwal * 100).toFixed(2);
    const tr = document.createElement("tr");
    tr.innerHTML = `<td>${date}</td><td>${saldoAwal}</td><td>${saldoAkhir.toFixed(2)}</td><td>${growth}</td><td>${data.totalTrades}</td><td>-</td>`;
    tbody.appendChild(tr);
  });
}

// ========== UNDUH CSV ==========
function downloadCSV(data, headers, filename) {
  const rows = [headers.join(",")];
  data.forEach(obj => {
    const row = headers.map(h => `"${obj[h] ?? ''}"`).join(",");
    rows.push(row);
  });
  const blob = new Blob([rows.join("\n")], { type: "text/csv" });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = filename;
  a.click();
  URL.revokeObjectURL(url);
}

document.getElementById("downloadHistory")?.addEventListener("click", () => {
  downloadCSV(history, ["pair", "lot", "position", "entryPrice", "exitPrice", "pips", "profit", "entryTime", "closeTime", "reason"], "riwayat_trading.csv");
});

document.getElementById("downloadRekap")?.addEventListener("click", () => {
  const data = [];
  document.querySelectorAll("#dailySummaryTable tbody tr").forEach(tr => {
    const tds = tr.querySelectorAll("td");
    data.push({
      Tanggal: tds[0].textContent,
      SaldoAwal: tds[1].textContent,
      SaldoAkhir: tds[2].textContent,
      Pertumbuhan: tds[3].textContent,
      TotalTrade: tds[4].textContent,
      Analisa: tds[5].textContent
    });
  });
  downloadCSV(data, ["Tanggal", "SaldoAwal", "SaldoAkhir", "Pertumbuhan", "TotalTrade", "Analisa"], "rekap_trading.csv");
});

// ========== MUAT DATA DARI LOCAL STORAGE ==========
function loadFromLocalStorage() {
  renderOpenTrades();
  renderTradeHistory();
  updateDailySummary();
}

// ========== PANGGIL SAAT PERTAMA DIMUAT ==========
window.addEventListener("DOMContentLoaded", () => {
  // Akses tidak langsung ditampilkan, tunggu validasi
});
</script>
</body>
</html>
